
#
# WepSIM (https://wepsim.github.io/wepsim/)
#


begin
{
          # R0 <- 0
          (EXCODE=0, T11, MR=1, SelC=0, LC=1),

 fetch:   # MAR <- PC
          # MBR <- Mem[MAR]
          # IR  <- MBR, PC <- PC + 4
          # jump to associated microcode for op. code
          (T2, C0),
          (TA, R, BW=11, M1=1, C1=1),
          (M2, C2, T1, C3),
          (A0, B=0, C=0)
}


################################################################################
#
# <TODO: replace this section with the base material of your laboratory>
#

# rdcyle: read cycles from internal control register
rdcycle reg1  {
      co=111111,
      nwords=1,
      reg1=reg(25,21),
      help='reg1 = load accumulated clock cycles',
      {
           (MH=1, T12=1, SELC=10101, LC=1, A0=1, B=1, C=0)
      }
}

# read from I/O device
in reg val {
     co=111111,
     nwords=1,
     reg=reg(25,21),
     val=imm(15,0),
     help='reg = device_registers[val]',
     {
         (SE=0, OFFSET=0, SIZE=10000, T3=1, C0=1),
         (TA=1, IOR=1, BW=11, M1=1, C1=1),
         (T1=1, LC=1,  MR=0, SELC=10101, A0=1, B=1, C=0)
     }
}

# write to I/O device
out reg val {
     co=111111,
     nwords=1,
     reg=reg(25,21),
     val=imm(15,0),
     help='device_register[val] = reg',
     {
         (SE=0, OFFSET=0,   SIZE=10000,   T3=1, C0=1),
         (MR=0, SELA=10101, T9=1,         M1=0, C1=1),
         (TA=1, TD=1,       IOW=1, BW=11, A0=1, B=1, C=0)
     }
}

#
# </TODO: replace this section with the base material of your laboratory>
#
################################################################################


################################################################################
#
# <TODO: replace this section with the extra material of your laboratory>
#

# halt execution
x_halt
{
     co=111111,
     nwords=1,
     {
        # PC, SP <- zero, salto a fetch
         (MR=1, SELA=0, T9,   M2=0, C2, SELC=10, LC=1, A0=1, B=1, C=0)
     }
}

#
# </TODO: replace this section with the extra material of your laboratory>
#
################################################################################

